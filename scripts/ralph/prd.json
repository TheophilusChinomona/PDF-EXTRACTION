{
  "project": "PDF-Extraction",
  "branchName": "ralph/hybrid-extraction-pipeline",
  "description": "Academic PDF Extraction Microservice with Hybrid Architecture (OpenDataLoader + Gemini) - 80% cost reduction, 95% accuracy, bounding boxes for citations",
  "completedStories": [
    {"id": "US-001", "title": "Create Python project structure and configuration", "passes": true},
    {"id": "US-002", "title": "Create requirements.txt with all dependencies", "passes": true},
    {"id": "US-003", "title": "Create Pydantic config with environment variable loading", "passes": true},
    {"id": "US-004", "title": "Create Gemini client initialization with error handling", "passes": true},
    {"id": "US-005", "title": "Create Pydantic models for extraction results", "passes": true},
    {"id": "US-006", "title": "Implement OpenDataLoader PDF structure extraction", "passes": true},
    {"id": "US-007", "title": "Implement quality scoring for routing decisions", "passes": true},
    {"id": "US-008", "title": "Implement hybrid extraction pipeline (OpenDataLoader + Gemini)", "passes": true},
    {"id": "US-009", "title": "Implement Vision fallback for low-quality PDFs", "passes": true},
    {"id": "US-010", "title": "Implement file upload validation", "passes": true},
    {"id": "US-011", "title": "Create Supabase client initialization", "passes": true},
    {"id": "US-012", "title": "Create database schema migration for extractions table", "passes": true},
    {"id": "US-013", "title": "Implement database storage functions for extractions", "passes": true},
    {"id": "US-014", "title": "Create FastAPI app with health check endpoint", "passes": true},
    {"id": "US-015", "title": "Create PDF extraction endpoint (POST /extract)", "passes": true},
    {"id": "US-016", "title": "Create extraction retrieval endpoint (GET /extractions/{id})", "passes": true},
    {"id": "US-017", "title": "Create bounding box retrieval endpoints", "passes": true},
    {"id": "US-018", "title": "Implement retry logic with exponential backoff", "passes": true},
    {"id": "US-019", "title": "Implement partial result storage", "passes": true},
    {"id": "US-020", "title": "Add request logging and metrics", "passes": true},
    {"id": "US-021", "title": "Add rate limiting middleware", "passes": true},
    {"id": "US-022", "title": "Create manual review queue for failed extractions", "passes": true},
    {"id": "US-023", "title": "Implement batch processing endpoint", "passes": true},
    {"id": "US-024", "title": "Implement webhook notifications", "passes": true}
  ],
  "userStories": [
    {
      "id": "US-025",
      "title": "Implement context caching for cost optimization",
      "description": "As a cost-conscious operator, I need Gemini context caching to reduce API costs by 90%.",
      "acceptanceCriteria": [
        "Update pdf_extractor.py to use context caching",
        "Cache system instruction prompt for academic PDF analysis",
        "Set cache TTL to 1 hour",
        "Track cache hits/misses in processing_metadata",
        "Calculate cost savings: add cached_tokens_saved to metadata",
        "Log cache statistics per request",
        "Add GET /stats/caching endpoint showing cache hit rate and savings",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Add routing statistics dashboard endpoint",
      "description": "As an operator, I need to see routing distribution and cost savings metrics.",
      "acceptanceCriteria": [
        "Add GET /stats/routing endpoint",
        "Query extractions table: count by processing_method",
        "Calculate average quality_score",
        "Calculate total_cost_usd, estimated_pure_vision_cost_usd, total_savings_usd, savings_percent",
        "Calculate performance metrics: avg_processing_time_seconds, p95_processing_time",
        "Return JSON with all metrics",
        "Cache results for 5 minutes to reduce database load",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Create integration tests for end-to-end extraction flow",
      "description": "As a developer, I need integration tests to verify the complete extraction pipeline works.",
      "acceptanceCriteria": [
        "Create tests/integration/test_extraction_flow.py",
        "Test: upload PDF → extract (hybrid) → store → retrieve → verify bounding boxes",
        "Test: upload scanned PDF → fallback to Vision → store → retrieve",
        "Test: upload duplicate PDF → return cached result",
        "Test: upload invalid file → return 400 error",
        "Test: batch processing with 3 PDFs → verify all complete",
        "Test: webhook delivery after extraction",
        "Use pytest fixtures for: test PDFs, mock Gemini client, test Supabase instance",
        "Tests pass",
        "Coverage > 80% for core extraction flow"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Create deployment documentation and Docker configuration",
      "description": "As a DevOps engineer, I need deployment instructions and containerization.",
      "acceptanceCriteria": [
        "Create Dockerfile: FROM python:3.11-slim",
        "Install dependencies from requirements.txt",
        "Set working directory to /app",
        "Copy app code",
        "Expose port 8000",
        "CMD: uvicorn app.main:app --host 0.0.0.0 --port 8000",
        "Create docker-compose.yml for local development (includes app service)",
        "Create DEPLOYMENT.md with: environment setup, Docker build/run, environment variables, health check verification",
        "Document Supabase setup steps (create project, run migrations)",
        "Document how to get Gemini API key",
        "All documentation clear and tested"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    }
  ]
}
