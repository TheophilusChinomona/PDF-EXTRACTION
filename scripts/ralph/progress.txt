# Ralph Progress Log

Started: 2026-01-28
Project: PDF-Extraction (Hybrid Architecture)
Branch: ralph/hybrid-extraction-pipeline

---

## Codebase Patterns

(Ralph will add discovered patterns here as work progresses)

---

## 2026-01-28 03:30 - US-001
- Implemented Python project structure and configuration
- Created directory structure: app/, app/routers/, app/services/, app/models/, app/db/, tests/
- Created .gitignore with Python, venv, and project-specific exclusions
- Created .env.example with API key placeholders
- Created __init__.py files in all Python packages
- Created comprehensive README.md with setup instructions and architecture overview

**Files changed:**
- Created: .gitignore, .env.example, README.md
- Created: app/__init__.py, app/routers/__init__.py, app/services/__init__.py, app/models/__init__.py, app/db/__init__.py, tests/__init__.py

**Learnings for future iterations:**
- Project follows standard Python package structure with clear separation of concerns
- All configuration should go through environment variables (.env file)
- Empty __init__.py files are needed to make directories valid Python packages
- .gitignore must include .env to prevent accidental secret commits

---

## 2026-01-28 04:00 - US-002
- Implemented requirements.txt with all project dependencies
- Added core dependencies: opendataloader-pdf (>=1.0.0), google-genai (>=0.3.0 - modern SDK)
- Added FastAPI ecosystem: fastapi (>=0.100.0), uvicorn (>=0.23.0)
- Added database client: supabase-py (>=2.0.0)
- Added data validation: pydantic (>=2.0.0), pydantic-settings (>=2.0.0)
- Added file handling utilities: python-multipart, python-dotenv, python-magic, httpx
- Added testing framework: pytest, pytest-asyncio, pytest-cov
- Installation already documented in README.md

**Files changed:**
- Created: requirements.txt
- Updated: scripts/ralph/prd.json (marked US-002 as passes: true)

**Learnings for future iterations:**
- Use google-genai (modern SDK) NOT google-generativeai (legacy)
- All dependencies have minimum version constraints (>=) for compatibility
- Test dependencies are included in requirements.txt for CI/CD setup
- README.md already contained installation instructions from US-001

---

## 2026-01-28 05:00 - US-003
- Implemented centralized configuration with Pydantic Settings
- Created app/config.py with Settings class extending pydantic_settings.BaseSettings
- Added configuration fields: gemini_api_key, supabase_url, supabase_key, model_name (default: gemini-3-flash-preview), enable_hybrid_mode (default: True)
- Implemented field validators for GEMINI_API_KEY, SUPABASE_URL, and SUPABASE_KEY with detailed error messages
- Created get_settings() function with @lru_cache for singleton pattern
- Fixed requirements.txt: corrected package name from supabase-py to supabase
- Created comprehensive test suite in tests/test_config.py with 13 tests covering:
  - Valid configuration loading
  - Custom configuration values
  - Missing/empty/whitespace-only API keys validation
  - Invalid Supabase URL validation (must be HTTPS)
  - Settings caching behavior
- All tests pass, typecheck passes with mypy

**Files changed:**
- Created: app/config.py, tests/test_config.py
- Updated: requirements.txt (supabase-py â†’ supabase)
- Updated: scripts/ralph/prd.json (marked US-003 as passes: true)

**Learnings for future iterations:**
- Use pydantic_settings.BaseSettings for environment variable loading (not pydantic.BaseSettings)
- Field validators should use @field_validator decorator with @classmethod
- Settings.model_config uses SettingsConfigDict (not nested Config class in Pydantic v2)
- Always validate credentials at startup to fail fast with clear error messages
- The Supabase Python package is named 'supabase' not 'supabase-py'
- Use @lru_cache on settings getter to ensure singleton pattern across the app
- Validators should strip whitespace from user inputs for better UX

---

